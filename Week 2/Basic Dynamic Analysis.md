# Basic Dynamic Analysis

## Why Dynamic Analysis?

- Performed by executing the malware
- performed when `static analysis` reaches dead end
- Allow the observation of malware's true functionalities
- Places system at risk

## Sandbox

- Analyse malware automatically and produce a report
- Provide easy-to-understand output
- Good for initial triage (use for fast analysis of malware - automatic)
- All sandboxes are similar in approach

### GFI Sandbox Overview

1. Malware is submitted to repository
        - User
        - Scripted submission

2. Malware is inserted into repository
3. Samples are retrieved from sandbox based on queue and priority
4. Analysis is sent back to repository
5. User view analysis result via web interface

#### GFI Sandbox Report Sample

- Basic Static Analysis
- High level dynamic analysis
- File activity Provided
    - Created
    - Read
    - Opened
    - Deleted
- Mutex created
- Changes to registry
- Network Activity by malware

#### What is a mutex

    - Program or object that allows multiple program thread to share the same resources, but not simultaneously
    - Uniquely named on program start

### Sandbox drawbacks

- Command line options
- Waiting for some command-and-control instructions
- Not all events may be recorded because the Sandbox did not wait long enough
- Malware may detect that it is running in a Sandbox
- Conditions are not met for Malware to run properly
- Sandbox OS may not be correct for the malware to run properly.

## Running of Malware

Malware comes in 2 forms
1. Executable (EXE)
2. Data Link Library (DLL)
        
        Installing a dll
            rundll32.exw DLLname, Export arguments

        DLL often runs most of their codes in their DLLMain Function
        If the DLL needs to install a service ; 
            rundll32 ipr32x.dll, installService ServiceName
            net start service name

## Process Monitor

- Combines functionalities of filemon and regmon
- Monitors
    - Registry Activity
    - File Activity
    - Process Activity
    - Network Activity
- Monitor system call for all processes by default
- Need to filter events (Has ready made filters)

## Process Explorer

- Provide insights to running processors
- Features
    - List active processes
    - DLL loaded for each process
    - Process properties
    - Active TCP connections
    - Create / Kill / Validate Processes

### Verify Option

- Verify if processed has been digitally signed by Microsoft
- Only apply to process on disk

## Monitoring Registry (RegShot)

- Regshot is opensource registry comparison tool
- Compares two registry snapshots and report differences

## CaptureBAT

- Behaviour Analysis Tool for WIN32 Applications
- Monitor state of system during execution of applications and processing of documents
- Performed at low kernal level
- Very good to exclude event noise that naturally occur in the system

## Monitoring Network Activity

- Malware send information to another server
- Tries to connect to a command-and-control server to await instructions
- requires a faking of network
- Able to reveal most functionalities

### ApateDNS

- Free tool from Mandiant
- Able to 
    - List DNS request made by malware
    - Spoof DNS responses
    - Set NXDomain (Error message if domain doesnâ€™t exist)

### Netcat

- TCP-IP Swiss Army Knife
- Used for inbound / outbound connections
    - Port Scanning
    - Tunneling
    - Proxying
    - Port forwarding
    - Etc. 

### Wireshark

- Opensource network sniffer
- Captures network packet
- Provides
    - Visualisation of network packets
    - Packet-stream analysis
    - In-depth packet analysis
